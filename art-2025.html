<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>订单管理系统</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ===== 通用 ===== */
body {
  margin: 0;
  font-family: system-ui;
  background: #f5f5f5;
}

/* ===== 登录注册 ===== */
.auth-box {
  max-width: 360px;
  margin: 80px auto;
  background: #fff;
  padding: 24px;
  border-radius: 14px;
}
.auth-box input {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}
.auth-box button {
  width: 100%;
  padding: 10px;
  margin-top: 16px;
}
.link {
  text-align: center;
  margin-top: 10px;
  color: #007bff;
  cursor: pointer;
}

/* ===== 模板1原样保留 ===== */
.container { max-width: 600px; margin: 0 auto; padding: 12px; }

.post { position: relative; background: #fff; border-radius: 10px; padding: 12px; margin-bottom: 12px; box-shadow: 0 1px 6px rgba(0,0,0,0.05); }
.post.refunded { filter: grayscale(1); opacity: 0.55; }

.row { display: flex; justify-content: space-between; gap: 10px; }
.info { font-size: 13px; line-height: 1.6; }

.status-tag { font-size: 12px; padding: 4px 10px; border-radius: 999px; cursor: pointer; white-space: nowrap; }
.unrefunded { background: #ff4d4f; color: #fff; }
.refunded-tag { background: #d4edda; color: #155724; }

.images { display: flex; gap: 6px; margin-top: 8px; overflow-x: auto; }
.images img { width: 60px; height: 60px; border-radius: 6px; object-fit: cover; cursor: pointer; }

.edit-btn { position: absolute; right: 12px; bottom: 12px; padding: 6px 12px; border-radius: 6px; background: #6c757d; color: #fff; font-size: 13px; cursor: pointer; }

.add-btn {
  position: fixed;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 26px;
  border-radius: 24px;
  background: #007bff;
  color: #fff;
  border: none;
  font-size: 15px;
  cursor: pointer;
}
.logout-btn {
  position: fixed;
  top: 12px;
  right: 12px;
  padding: 6px 12px;
}
</style>
</head>

<body>

<!-- 登录 -->
<div class="auth-box" id="loginBox">
  <h2>登录</h2>
  <input id="loginUsername" placeholder="用户名">
  <input id="loginPassword" type="password" placeholder="密码">
  <button onclick="login()">登录</button>
  <div class="link" onclick="showRegister()">没有账号？注册</div>
</div>

<!-- 注册 -->
<div class="auth-box" id="registerBox" style="display:none;">
  <h2>注册</h2>
  <input id="regUsername" placeholder="用户名">
  <input id="regPassword" type="password" placeholder="密码">
  <button onclick="register()">注册</button>
  <div class="link" onclick="showLogin()">返回登录</div>
</div>

<!-- 模板1主界面 -->
<div id="app" style="display:none;">
  <button class="logout-btn" onclick="logout()">退出</button>
  <div class="container" id="list"></div>
  <button class="add-btn" onclick="alert('下一步接 Orders API')">➕ 新建订单</button>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbynL5cgXPC0Lqbftc6hUIAi0dawiOpSksmqeHOs7RfhFkkKkQ8r4dktiBGz1u98dMs/exec';

const loginBox = document.getElementById('loginBox');
const registerBox = document.getElementById('registerBox');
const app = document.getElementById('app');

/* ===== 登录状态判断 ===== */
if (localStorage.getItem('userId')) {
  showApp();
}

/* ===== 登录注册 ===== */
function showRegister() {
  loginBox.style.display = 'none';
  registerBox.style.display = 'block';
}

function showLogin() {
  registerBox.style.display = 'none';
  loginBox.style.display = 'block';
}

function login() {
  fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      action: 'login',
      username: loginUsername.value,
      password: loginPassword.value
    })
  })
  .then(r => r.json())
  .then(d => {
    if (!d.success) return alert(d.message);
    localStorage.setItem('userId', d.userId);
    localStorage.setItem('username', d.username);
    showApp();
  });
}

function register() {
  fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      action: 'register',
      username: regUsername.value,
      password: regPassword.value
    })
  })
  .then(r => r.json())
  .then(d => {
    if (!d.success) return alert(d.message);
    localStorage.setItem('userId', d.userId);
    localStorage.setItem('username', d.username);
    showApp();
  });
}

function logout() {
  localStorage.clear();
  location.reload();
}

function showApp() {
  loginBox.style.display = 'none';
  registerBox.style.display = 'none';
  app.style.display = 'block';
}
</script>

</body>
</html>
