const SHEET_ID = "1dRrUW5mneFbRW6ik-mEGmwU6atlbi2pM7k7sTLUJgGo"; // æ›¿æ¢ä¸ºä½ çš„ Sheet ID
const SHEET_NAME = "Sheet1"; // æ›¿æ¢ä¸ºä½ çš„å·¥ä½œè¡¨åç§°

function doGet(e) {
  return getData();
}

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);

    // å¦‚æœæ˜¯æäº¤è¡¨å•
    if(data.name) {
      const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);
      sheet.appendRow([
        new Date(),
        data.name || "",
        data.verb1 || "",
        data.verb2 || "",
        data.adverb1 || "",
        data.adverb2 || "",
        data.remark || ""
      ]);
      return ContentService.createTextOutput(JSON.stringify({status:"ok"}))
        .setMimeType(ContentService.MimeType.JSON);
    }

    return getData();
  } catch(err){
    return ContentService.createTextOutput(JSON.stringify({status:"error", message:err.message}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// ğŸ”¹ è·å–å·²æäº¤æ•°æ®
function getData() {
  const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);
  const rows = sheet.getDataRange().getValues();
  const result = [];
  for(let i=1; i<rows.length; i++){ // è·³è¿‡è¡¨å¤´
    result.push({
      name: rows[i][1],
      verb1: rows[i][2],
      verb2: rows[i][3],
      adverb1: rows[i][4],
      adverb2: rows[i][5],
      remark: rows[i][6]
    });
  }
  return ContentService.createTextOutput(JSON.stringify(result))
    .setMimeType(ContentService.MimeType.JSON);
}

// ğŸ”¹ å·¥å…·ï¼šFisherâ€“Yates æ´—ç‰Œ
function shuffleArray(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
